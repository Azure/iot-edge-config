# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

steps:  
- task: AzureCLI@2
  inputs:
    azureSubscription: 'Connection to Pipeline resources for IoT Edge Config'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      cd tests/e2e-tests
      chmod +x test-devicestate.sh
      ./test-devicestate.sh $(AzureSubscriptionId)
  displayName: 'Run All E2E Tests'
- task: CopyFiles@2
  inputs:
    contents: '/tmp/azure-iot-edge-installer-*.log'
    targetFolder: $(Build.ArtifactStagingDirectory)
  displayName: 'Copy logs'
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(Build.ArtifactStagingDirectory)
    artifactName: AzureIotEdgeInstallerLogs
  displayName: 'Publish logs'

